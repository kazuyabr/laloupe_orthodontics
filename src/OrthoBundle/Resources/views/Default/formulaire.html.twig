{# @OrthoBundle/Resources/views/Default/formulaire.html.twig #}
{% extends 'base.html.twig' %}
{% block body %}
    <h3 xmlns="http://www.w3.org/1999/html">
        {{ actualUser[0].nom }} -
        {{ actualUser[0].adresse }} -
        {{ actualUser[0].codePostal }} {{ actualUser[0].ville }}
        <!--. N° : {{ actualUser[0].telephone }}-->
    </h3>
    <form id="msform" action="{{ path('ortho_formulaire') }}" method="post">
        <!-- Barre de progression -->
        <ul id="progressbar">
            <li class="active"></li>
            <li></li>
            <li></li>
        </ul>
        {{ form_start(form) }}
        <fieldset class="smallbloc"> <!-- Bloc n°1 : Les informations générales du patient -->
            {{ form_label(form.referencePatient, "Référence du patient") }}
            <h2 class="fs-title">Informations du patient</h2>

            {{ form_label(form.referencePatient, "Référence du patient* : ") }}
            {{ form_errors(form.referencePatient) }}
            {{ form_widget(form.referencePatient) }}

            {{ form_label(form.prenomPatient, "Prénom* :") }}
            {{ form_errors(form.prenomPatient) }}
            {{ form_widget(form.prenomPatient) }}

            {{ form_label(form.dateretour, "Date de retour souhaitée* : ") }}
            {{ form_errors(form.dateretour) }}
            {{ form_widget(form.dateretour) }}

            <input type="button" name="next" class="next action-button" value="Suivant"/>
        </fieldset>
        <fieldset class="largebloc"> <!-- Bloc n°2 : L'aspect technique | Appareillages & Adjonctions -->
            <h2 class="fs-title">Appareillages & Adjonctions</h2>
            <h3 class="fs-subtitle">Les choix dentaires à faire pour le patient</h3>
            <div id='blocApp' class='blocAppAdj'>
                {{ form_label(form.appareillages, "Appareillages : ") }}
                {{ form_errors(form.appareillages) }}
                {{ form_widget(form.appareillages) }}

                {{ form_widget(form.ajoutApp, { 'label': 'Bibilothèque Appareillages' }) }}

                <!-- Modal Appareillage -->
                {% include '@Ortho/Default/modalApp.html.twig' %}
            </div>

            <div id='blocAdj' class='blocAppAdj'>
                {{ form_label(form.adjonctions, "Adjonctions : ") }}
                {{ form_errors(form.adjonctions) }}
                {{ form_widget(form.adjonctions) }}

                {{ form_widget(form.ajoutAdj, { 'label': 'Bibliothèque Adjonctions' }) }}

                <!-- Modal Adjonction -->
                {#{% include '@Ortho/Default/...' %}#}
            </div>

            <div id="coulmot">
                {{ form_label(form.couleur, "Couleur : ") }}
                {{ form_errors(form.couleur) }}
                {{ form_widget(form.couleur) }}

                {{ form_label(form.motif, "Motif :") }}
                {{ form_errors(form.motif) }}
                {{ form_widget(form.motif) }}
            </div>

            {{ form_label(form.commentaireLabo, "Commentaires : ") }}
            {{ form_errors(form.commentaireLabo) }}
            {{ form_widget(form.commentaireLabo) }}
            <div id="appCommentInter"></div>

            <input type="button" name="previous" class="previous action-button" value="Précédent"/>
            <input type="button" name="next" class="next action-button" value="Suivant"/>
        </fieldset>
        <fieldset class="smallbloc"> <!-- Bloc n°3 : Les pièces jointes -->
            <h2 class="fs-title">Pièces jointes complémentaires</h2>
            <h3 class="fs-subtitle">Toutes les pièces jointes à apporter à la commande.</h3>

            {{ form_label(form.pathPJ1, "Arcade Maxilaire :") }}
            {{ form_errors(form.pathPJ1) }}
            {{ form_widget(form.pathPJ1) }}

            {{ form_label(form.pathPJ2, "Arcade Mandibulaire :") }}
            {{ form_errors(form.pathPJ2) }}
            {{ form_widget(form.pathPJ2) }}

            {{ form_label(form.pathPJ3, "Autre pièces jointe :") }}
            {{ form_errors(form.pathPJ3) }}
            {{ form_widget(form.pathPJ3) }}

            <input type="button" name="previous" class="previous action-button" value="Précédent"/>
            <input type="submit" name="previous" class="action-button" value="ENVOYER"/>

            {{ form_rest(form) }}
            {{ form_end(form) }}
        </fieldset>
    </form>
{% endblock %}

{% block javascript %}
    <script>
        var appareillages = {
            {% for namepictures in nomimageapp %}
            "{{ namepictures.id }}": {
                "title": "{{ namepictures.nom }}",
                "img": "{{ namepictures.image }}",
                "family": "{{ namepictures.famille }}"
            },
            {% endfor %}
        };
    </script>
    <script src="{{ asset('bundles/ortho/js/calendrierFormulaire.js') }}"></script>
    <script src="{{ asset('bundles/ortho/js/formulairejQuery.js') }}"></script>
    <script src="{{ asset('bundles/ortho/js/recherchejQuery.js') }}"></script>
    <script src="{{ asset('bundles/ortho/js/triParFamille.js') }}"></script>

    <script>
        // div display-none valable pour tous les ajouts de commentaire
        var comment = $('#appCommentInter');

        // Liste des appareillages | Affichage des commentaires dans le cadre
        var tableauApp = {
            {% for commentaire in commentaireAppareil %}
            "{{ commentaire['id'] }}" :
            "{{ commentaire['nom'] }} ({{ commentaire['famille'] }}) : \n{{ commentaire['commentaire'] }}" ,
            {% endfor %}
        };

        var checkboxesApp = $('div#commandes_appareillages input[type=checkbox]');

        checkboxesApp.on('click', function () {
            if ($(this).prop('checked')) {
                comment.append('<div class="commentaireClass" id="commentaireEnfant' + $(this).val() + '">' + tableauApp[$(this).val()] + '</div>');
            }
            else {
                $('#commentaireEnfant' + $(this).val()).remove();
            }

            $('#commandes_commentaireLabo').html('');

            $('.commentaireClass').each(function () {
                $('#commandes_commentaireLabo').append($(this).html() + "\n");
            });
        });

        // Liste des adjonctions + Affichage des commentaires dans le cadre
        var tableauAdj = {
        {% for commentaire in commentaireAdjonction %}
        "{{ commentaire['id'] }}" :
        "{{ commentaire['nom'] }}({{ commentaire['famille'] }}) : \n{{ commentaire['commentaire'] }}" ,
        {% endfor %}
        };

        var checkboxesAdjonctions = $('div#commandes_adjonctions input[type=checkbox]');

        checkboxesAdj.on('click', function () {
            if ($(this).prop('checked')) {
                comment.append('<div class="commentaireClass" id="commentaireEnfant' + $(this).val() + '">' + tableauAdj[$(this).val()] + '</div>');
            }
            else {
                $('#commentaireEnfant' + $(this).val()).remove();
            }

            $('#commandes_commentaireLabo').html('');

            $('.commentaireClass').each(function () {
                $('#commandes_commentaireLabo').append($(this).html() + "\n");
            });
        });

        // Affichage commentaire PJ dans commentaire principale
        /*
         $('#commandes_comment2').change(function () {
         $('#commandes_comment').val($(this).val());
         });
         */
        $('#commandes_comment2').change(function () {
            comment.append('<div class="commentaireClass" id="commentaireEnfant2' + $(this).val() + '">' + '</div>');

            $('#commandes_comment').html($('#commandes_comment').val() + "- " + $(this).val() + ".");

        });

        // Affichage des images pour Couleurs et Motifs
        var monSelectCouleur = $('#commandes_fidCouleur');
        monSelectCouleur.on('change', function () {
            $('#remplissageCadreCouleur').attr('src', "{{ asset('bundles/ortho/img/couleurs/') }}" + monSelectCouleur.val() + ".png");
        });

        var monSelectMotif = $('#commandes_fidMotif');
        monSelectMotif.on('change', function () {
            $('#remplissageCadreMotif').attr('src', "{{ asset('bundles/ortho/img/motifs/') }}" + monSelectMotif.val() + ".png");
        });
    </script>
{% endblock %}
